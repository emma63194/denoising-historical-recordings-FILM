# 🚀 Prototype 快速驗證指南

## 配置說明

### 極簡化設計原則
為了在 **10-30 分鐘內**驗證模型可行性，做了以下精簡：

### 📊 數據集縮減
| 項目 | 完整版 | Prototype | 說明 |
|------|--------|-----------|------|
| 訓練數據 | 3個數據集混合 | 單個說話者 | 只用 AISHELL-3/SSB0005 |
| 訓練片段長度 | 5 秒 | 3 秒 | 加快處理速度 |
| 噪音數據 | 完整 | 完整 | 保持噪音多樣性 |

### ⚡ 訓練速度優化
| 項目 | 完整版 | Prototype | 影響 |
|------|--------|-----------|------|
| Epochs | 73 | 10 | 快速迭代 |
| 每 epoch 步數 | 1000 | 100 | 10倍加速 |
| Batch size | 16 | 8 | 減少記憶體和計算 |
| Workers | 10 | 4 | 減少 I/O 負擔 |

### 🏗️ 模型縮小
| 參數 | 完整版 | Prototype | 說明 |
|------|--------|-----------|------|
| num_stages | 3 | 2 | U-Net 階段數 |
| depth | 6 | 4 | 網路深度 |
| num_tfc | 3 | 2 | TFC 塊數量 |

**模型參數量約減少 40-50%**

---

## 🚀 快速開始

### 1. 檢查數據
```bash
# 確認單個說話者數據存在
ls "/Volumes/SP SSD 120/data_aishell3/train/wav/SSB0005/"*.wav | head -5
```

### 2. 啟動訓練
```bash
# 方法 1: 使用腳本（推薦）
./train_prototype.sh

# 方法 2: 直接命令
python train.py --config-name conf_prototype
```

### 3. 監控訓練
```bash
# 開啟另一個終端
tensorboard --logdir experiments/tensorboard_logs
# 瀏覽器開啟: http://localhost:6006
```

---

## 📈 預期結果

### 訓練過程
```
Epoch 1/10: Loss 開始較高 (0.05-0.1)
Epoch 5/10: Loss 應該下降 (0.02-0.04)
Epoch 10/10: Loss 穩定 (0.01-0.03)
```

### 成功指標
✅ **訓練不報錯** - 數據載入、模型前向/反向傳播正常  
✅ **Loss 下降** - 證明模型在學習  
✅ **推論可執行** - 能產生降噪音頻  
✅ **記憶體穩定** - 不會 OOM（記憶體溢出）

### 失敗排除
❌ 找不到數據 → 檢查外接硬碟  
❌ OOM 錯誤 → 降低 `batch_size` 到 4  
❌ 訓練太慢 → 確認 GPU 是否啟用（如果有）  

---

## 🔍 驗證步驟

### 訓練完成後：

#### 1. 檢查模型檔案
```bash
ls -lh experiments/prototype/checkpoint/
# 應該看到 checkpoint 文件
```

#### 2. 快速推論測試
```bash
python inference.py \
  --config-name conf_prototype \
  inference.audio="/Users/shizukaryu/Documents/學校/論文/dataset/test_movie/test.wav"
```

#### 3. 聽一下結果
降噪後的音頻會儲存在輸出目錄，用播放器聽聽看：
- 噪音是否明顯減少？
- 語音是否清晰保留？
- 有無異常失真？

---

## 📊 TensorBoard 觀察重點

開啟 TensorBoard 後，重點看：

### 1. **Loss 曲線**
- 訓練 loss 應該持續下降
- 驗證 loss 不應該上升（過擬合徵兆）

### 2. **音頻樣本**（如果有）
- 查看推論結果的音頻波形
- 對比乾淨/噪音/降噪三者

### 3. **指標**
- SNR（信噪比）改善
- PESQ/STOI 等語音質量指標

---

## 🎯 下一步決策

### ✅ 如果 Prototype 成功：
1. **分析結果**
   - Loss 曲線是否正常？
   - 降噪效果是否符合預期？
   - 模型是否過擬合？

2. **擴展到完整訓練**
   ```bash
   # 使用完整配置
   python train.py
   ```

3. **調優方向**
   - 增加數據多樣性（加入音效、音樂）
   - 調整模型大小
   - 實驗不同的 loss function
   - 調整 SNR 範圍

### ❌ 如果遇到問題：
1. **檢查日誌**
   ```bash
   cat experiments/prototype/train.log  # 如果有的話
   ```

2. **常見問題**
   - 數據載入錯誤 → 檢查路徑
   - OOM → 降低 batch_size
   - Loss 不下降 → 檢查學習率、數據質量

3. **調試模式**
   - 減少到 5 個 epoch
   - 減少到 50 步/epoch
   - 只用 10 個音頻文件測試

---

## 💡 Prototype vs 完整版對比

| 方面 | Prototype | 完整版 |
|------|-----------|--------|
| **訓練時間** | 10-30 分鐘 | 數小時到數天 |
| **數據量** | ~100 個文件 | 數萬個文件 |
| **模型性能** | 基本驗證 | 產品級質量 |
| **適用場景** | 概念驗證、快速迭代 | 最終部署 |
| **資源需求** | 低（筆電可跑） | 高（建議 GPU） |

---

## 📝 檢查清單

開始前確認：
- [ ] 外接硬碟已連接
- [ ] SSB0005 目錄存在且有音頻
- [ ] Gramophone 噪音數據可訪問
- [ ] Python 環境正確（TensorFlow 等）
- [ ] 至少有 4GB 可用 RAM

訓練後驗證：
- [ ] Loss 有下降
- [ ] 沒有錯誤訊息
- [ ] 產生了 checkpoint 文件
- [ ] 推論可以執行
- [ ] 降噪效果基本可見

---

## 🚨 重要提醒

1. **這只是驗證** - Prototype 不是最終模型，效果會比完整訓練差
2. **快速迭代** - 如果發現問題，可以快速調整配置重新訓練
3. **保存實驗** - 記錄每次 prototype 的配置和結果，方便對比
4. **監控資源** - 用 `htop` 或活動監視器查看 CPU/記憶體使用

預祝 Prototype 訓練順利！🎉
